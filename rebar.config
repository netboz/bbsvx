{erl_opts,
 [debug_info,
  {platform_define, "(linux|solaris|freebsd|darwin)", 'BUILD_WITHOUT_QUIC', true}]}.

{deps,
 [{erlog, {git, "https://github.com/rvirding/erlog.git"}},
  {erlang_uuid,
   "",
   {git, "https://github.com/avtobiff/erlang-uuid.git", {branch, "master"}}},
  {ejabberd, {git, "https://github.com/processone/ejabberd.git"}},
  {emqtt, {git, "https://github.com/emqx/emqtt.git"}},
  {uuid, "", {git, "https://github.com/avtobiff/erlang-uuid.git", {branch, "master"}}},
  {riak_dt, {git, "https://github.com/basho/riak_dt.git"}},
  {quickrand, {git, "https://github.com/okeuday/quickrand.git"}},
  cowboy,
  jiffy,
  gproc,
  %% Tracing and metrics
  jsonlog,
  {opentelemetry_api,
   {git_subdir,
    "http://github.com/open-telemetry/opentelemetry-erlang",
    {branch, "main"},
    "apps/opentelemetry_api"}},
  {opentelemetry,
   {git_subdir,
    "http://github.com/open-telemetry/opentelemetry-erlang",
    {branch, "main"},
    "apps/opentelemetry"}},
  {opentelemetry_exporter,
   {git_subdir,
    "http://github.com/open-telemetry/opentelemetry-erlang",
    {branch, "main"},
    "apps/opentelemetry_exporter"}},
  prometheus,
  prometheus_httpd]}.

{shell,
 [{sys_config_src, "config/sys.config.src"},
  {apps,
   [sasl,
    ssl,
    compiler,
    syntax_tools,
    runtime_tools,
    opentelemetry_api,
    opentelemetry_exporter,
    jsonlog,
    {opentelemetry, temporary},
    prometheus,
    prometheus_httpd,
    cowboy,
    jiffy,
    riak_dt,
    mnesia,
    ejabberd,
    emqtt,
    mqtree,
    gproc,
    uuid,
    quickrand,
    erlog,
    bbsvx]},
  {extended_start_script, true},
  {dev_mode, true}]}.

{project_plugins, [rebar3_format]}.

{relx,
 [{release,
   {bbsvx, "0.1.0"},
   [sasl,
    ssl,
    compiler,
    syntax_tools,
    runtime_tools,
    opentelemetry_api,
    opentelemetry_exporter,
    jsonlog,
    {opentelemetry, temporary},
    prometheus,
    prometheus_httpd,
    cowboy,
    jiffy,
    riak_dt,
    mnesia,
    ejabberd,
    merge_index,
    emqtt,
    mqtree,
    gproc,
    uuid,
    quickrand,
    erlog,
    bbsvx]},
  {sys_config_src, "config/sys.config.src"},
  {vm_args_src, "./config/vm.args.src"},
  {dev_mode, false},
  {include_erts, false},
  {extended_start_script, true}]}.

{overrides,
 [{add,
   ejabberd,
   [{pre_hooks,
     [{compile, "sh ${REBAR_DEPS_DIR}/ejabberd/autogen.sh"},
      {compile, "sh ${REBAR_DEPS_DIR}/ejabberd/configure"}]}]}]}.
