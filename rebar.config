{erl_opts, [
    debug_info,
    {platform_define, "(linux|solaris|freebsd|darwin)", 'BUILD_WITHOUT_QUIC', true}
]}.

%% Source directories
{src_dirs, ["src"]}.

{deps, [
    {erlog, {git, "https://github.com/rvirding/erlog.git"}},
    {uuid, {git, "https://github.com/okeuday/uuid.git"}},
    {ulid, {git, "https://github.com/savonarola/ulid.git"}},
    {riak_dt, {git, "https://github.com/basho/riak_dt.git"}},
    {quickrand, {git, "https://github.com/okeuday/quickrand.git"}},
    {jobs, {git, "https://github.com/uwiger/jobs.git"}},
    {logjam, {git, "https://github.com/lfex/logjam.git"}},
    {cowboy, "2.12.0"},
    ranch,
    jiffy,
    gproc,

    %% Tracing and metrics
    prometheus,
    prometheus_httpd
]}.

{cuttlefish, [
    {file_name, "bbsvx.conf"},
    {schema_discovery, true}
]}.

{shell, [
    {sys_config_src, "./config/sys.config.src"},
    {vm_args_src, "./config/vm.args.src"},
    {apps, [
        sasl,
        ssl,
        logjam,

        prometheus,
        prometheus_httpd,
        cowboy,
        jobs,
        jiffy,
        riak_dt,
        ulid,
        {cuttlefish, load},
        mnesia,
        gproc,
        uuid,
        quickrand,
        cuttlefish,
        erlog,
        bbsvx
    ]},
    {include_erts, true},
    {extended_start_script, false},
    {use_nodetool, true},
    {overlay_vars, "config/vars.config"},
    {overlay, [
        {template, "config/advanced.config", "etc/advanced.config"}
    ]},
    {dev_mode, true}
]}.

{relx, [
    {release, {bbsvx, "0.1.0"}, [
        sasl,
        ssl,

        prometheus,
        prometheus_httpd,
        cowboy,
        jobs,
        logjam,
        jiffy,
        ulid,
        riak_dt,
        syntax_tools,
        mnesia,
        gproc,
        uuid,
        quickrand,
        erlog,
        cuttlefish,
        bbsvx
    ]},
    {include_erts, true},
    {extended_start_script, false},
    {overlay_vars, "config/vars.config"},

    {dev_mode, false},
    {overlay, [
        {template, "config/advanced.config", "etc/advanced.config"}
    ]}
]}.

{profiles, [
    {test, [
        %  {deps, [meck]},
        {include_erts, true},
        {extended_start_script, false},
        {overlay_vars, "config/vars.config"},

        {dev_mode, true},
        {overlay, [
            {template, "config/advanced.config", "etc/advanced.config"}
        ]}
    ]}
]}.
{profiles, [
    {prod, [
        {relx, [
            {include_erts, true},
            % {template, "priv/advanced.config", "etc/advanced.config"},
            {dev_mode, false},
            {extended_start_script, false},
            {overlay_vars, "config/vars.config"}
        ]}
    ]}
]}.

{ct_opts, [{keep_logs, 10}, {dir, ["./ct"]}, {include, ["./include"]}]}.

{project_plugins, [
    {rebar3_cuttlefish, {git, "https://github.com/vernemq/rebar3_cuttlefish", {branch, "master"}}},
    erlfmt,
    rebar3_ex_doc
]}.

%% Ex_doc configuration for documentation generation
{ex_doc, [
    {extras, [
        {"README.md", #{title => "Overview"}},
        {"CLAUDE.md", #{title => "Development Guide"}}
    ]},
    {main, "README.md"},
    {homepage_url, "https://github.com/bbsvx/bbsvx"},
    {source_url, "https://github.com/bbsvx/bbsvx"},
    {api_reference, true},
    {proglang, erlang}
]}.

%% Cuttlefish configuration - use config/ directory for schema files
{cuttlefish, [
    {schema_dir, "config"}
]}.
